{"ast":null,"code":"import { global } from \"@/stores/global\";\nimport { onMounted, ref } from \"vue\";\nimport gsap from \"gsap\";\nexport default {\n  __name: 'loading',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const store = global();\n    // 加载效果控制模块\n    const loading = {\n      // DOM元素\n      icon: null,\n      paths: null,\n      tip: null,\n      circle: null,\n      mask: null,\n      // 动画播放器\n      animater: null,\n      if_visible: ref(true),\n      //是否可见\n      init() {\n        this.icon = document.querySelector(\".loading_icon\");\n        this.paths = [...document.querySelectorAll(\".loading_icon path\")];\n        this.tip = document.querySelector(\".loading_tip\");\n        this.circle = document.querySelector(\".loading_circle\");\n        this.mask = document.querySelector(\".loading_mask\");\n        // loading初始动画：小蛇循环划8\n        this.animater = gsap.timeline().fromTo(this.paths,\n        // 间隔开两端线条的描边偏移：使虚线线段呈现一个小蛇的样子\n        {\n          strokeDashoffset: i => {\n            if (i === 0) return 0;else return 480;\n          }\n        }, {\n          strokeDashoffset: i => {\n            if (i === 0) return -275;else return 205;\n          },\n          duration: 2,\n          ease: \"linear\",\n          onComplete: () => {\n            // 每播放完一次，检查一下加载状态，加载完成则执行完成动画，反之继续循环播放等待加载\n            if (document.readyState === \"complete\") this.finish();else this.animater.restart();\n          }\n        });\n      },\n      // 加载完成：小蛇变成一个球\n      finish() {\n        this.animater = gsap.timeline()\n        // 动画的第一部分：蛇头缩放消失，蛇身虚线偏移成圆形，并汇聚成实线，整体缩小以适应一会儿出现的文字\n        .to(this.paths[1], {\n          strokeWidth: 0,\n          duration: 0.4,\n          ease: \"power3.out\"\n        }).to(this.paths[0], {\n          strokeDashoffset: -300,\n          duration: 0.4,\n          ease: \"power3.out\"\n        }, \"<\").to(this.paths[0], {\n          strokeDasharray: \"138 0 0 0 0 0 0 0 0 500\",\n          duration: 0.7,\n          ease: \"power3.out\"\n        }, \"<\").to(this.icon, {\n          scale: 0.6,\n          duration: 0.7,\n          ease: \"power3.out\"\n        }, \"<\")\n        // 动画的第二部分：提示文字显示\n        .to(this.tip, {\n          clipPath: \"circle(100%)\",\n          y: 0,\n          duration: 0.7,\n          ease: \"power3.out\"\n        }, \"<0.3\").to(this.circle, {\n          opacity: 1,\n          duration: 0.7,\n          ease: \"power3.out\"\n        }, \"<\");\n      },\n      // 隐藏loading动画\n      hidden(immediate, next) {\n        // 动画播放器播放完后：才可以执行函数播放后续动画，否则会因为动画冲突导致BUG\n        if (this.animater.isActive()) return;\n        if (immediate) immediate(); //存在立即执行函数，则立即执行\n        // 隐藏loading\n        this.animater = gsap.timeline().to(this.tip, {\n          cursor: \"auto\",\n          scale: 0,\n          duration: 1,\n          ease: \"power3.out\"\n        }).to(this.mask, {\n          scale: 1,\n          duration: 2.5,\n          ease: \"power3.out\",\n          onComplete: () => {\n            this.if_visible.value = false; // 动画完成后，隐藏loading\n            if (next) next(); //如果有后续函数，则执行\n          }\n        }, \"<\");\n      }\n    };\n    // 储存全局功能函数\n    store.hidden_loading = loading.hidden.bind(loading);\n    onMounted(() => {\n      loading.init();\n    });\n    const __returned__ = {\n      store,\n      loading,\n      get global() {\n        return global;\n      },\n      onMounted,\n      ref,\n      get gsap() {\n        return gsap;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["global","onMounted","ref","gsap","store","loading","icon","paths","tip","circle","mask","animater","if_visible","init","document","querySelector","querySelectorAll","timeline","fromTo","strokeDashoffset","i","duration","ease","onComplete","readyState","finish","restart","to","strokeWidth","strokeDasharray","scale","clipPath","y","opacity","hidden","immediate","next","isActive","cursor","value","hidden_loading","bind"],"sources":["E:/SnakeBall/src/components/layout/loading.vue"],"sourcesContent":["<template>\r\n    <div class=\"loading _fullscreen\" v-show=\"loading.if_visible.value\">\r\n        <svg viewBox=\"0 0 100 50\" class=\"loading_icon\">\r\n            <path\r\n                d=\"M50,25c0-12.14,9.84-21.99,21.99-21.99S93.98,12.86,93.98,25s-9.84,21.99-21.99,21.99S50,37.21,50,25.06\r\n        S40.16,3.01,28.01,3.01S6.02,12.86,6.02,25s9.84,21.99,21.99,21.99S50,37.14,50,25c0-8.14,4.42-15.24,10.99-19.05\r\n        C67.57,9.76,71.99,16.86,71.99,25c0,8.14-4.42,15.24-10.99,19.04c0,0,0,0,0,0c-3.23,1.87-6.99,2.94-10.99,2.94\r\n        c-4.01,0-7.76-1.07-10.99-2.94h0C32.43,40.24,28.01,33.14,28.01,25c0-8.14,4.42-15.24,10.99-19.05l0,0\r\n        C42.24,4.08,45.99,3.01,50,3.01s7.76,1.07,10.99,2.94l0,0\"\r\n            />\r\n            <path\r\n                d=\"M50,25c0-12.14,9.84-21.99,21.99-21.99S93.98,12.86,93.98,25s-9.84,21.99-21.99,21.99S50,37.21,50,25.06\r\n        S40.16,3.01,28.01,3.01S6.02,12.86,6.02,25s9.84,21.99,21.99,21.99S50,37.14,50,25c0-8.14,4.42-15.24,10.99-19.05\r\n        C67.57,9.76,71.99,16.86,71.99,25c0,8.14-4.42,15.24-10.99,19.04c0,0,0,0,0,0c-3.23,1.87-6.99,2.94-10.99,2.94\r\n        c-4.01,0-7.76-1.07-10.99-2.94h0C32.43,40.24,28.01,33.14,28.01,25c0-8.14,4.42-15.24,10.99-19.05l0,0\r\n        C42.24,4.08,45.99,3.01,50,3.01s7.76,1.07,10.99,2.94l0,0\"\r\n            />\r\n        </svg>\r\n        <div class=\"loading_mask\"></div>\r\n        <div class=\"loading_circle\"></div>\r\n        <p class=\"loading_tip _font_2\" @click=\"store.first_show\">START</p>\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { global } from \"@/stores/global\";\r\nimport { onMounted, ref } from \"vue\";\r\nimport gsap from \"gsap\";\r\nconst store = global();\r\n// 加载效果控制模块\r\nconst loading = {\r\n    // DOM元素\r\n    icon: null,\r\n    paths: null,\r\n    tip: null,\r\n    circle: null,\r\n    mask: null,\r\n    // 动画播放器\r\n    animater: null,\r\n    if_visible: ref(true), //是否可见\r\n    init() {\r\n        this.icon = document.querySelector(\".loading_icon\");\r\n        this.paths = [...document.querySelectorAll(\".loading_icon path\")];\r\n        this.tip = document.querySelector(\".loading_tip\");\r\n        this.circle = document.querySelector(\".loading_circle\");\r\n        this.mask = document.querySelector(\".loading_mask\");\r\n        // loading初始动画：小蛇循环划8\r\n        this.animater = gsap.timeline().fromTo(\r\n            this.paths,\r\n            // 间隔开两端线条的描边偏移：使虚线线段呈现一个小蛇的样子\r\n            {\r\n                strokeDashoffset: (i) => {\r\n                    if (i === 0) return 0;\r\n                    else return 480;\r\n                },\r\n            },\r\n            {\r\n                strokeDashoffset: (i) => {\r\n                    if (i === 0) return -275;\r\n                    else return 205;\r\n                },\r\n                duration: 2,\r\n                ease: \"linear\",\r\n                onComplete: () => {\r\n                    // 每播放完一次，检查一下加载状态，加载完成则执行完成动画，反之继续循环播放等待加载\r\n                    if (document.readyState === \"complete\") this.finish();\r\n                    else this.animater.restart();\r\n                },\r\n            }\r\n        );\r\n    },\r\n    // 加载完成：小蛇变成一个球\r\n    finish() {\r\n        this.animater = gsap\r\n            .timeline()\r\n            // 动画的第一部分：蛇头缩放消失，蛇身虚线偏移成圆形，并汇聚成实线，整体缩小以适应一会儿出现的文字\r\n            .to(this.paths[1], {\r\n                strokeWidth: 0,\r\n                duration: 0.4,\r\n                ease: \"power3.out\",\r\n            })\r\n            .to(\r\n                this.paths[0],\r\n                {\r\n                    strokeDashoffset: -300,\r\n                    duration: 0.4,\r\n                    ease: \"power3.out\",\r\n                },\r\n                \"<\"\r\n            )\r\n            .to(\r\n                this.paths[0],\r\n                {\r\n                    strokeDasharray: \"138 0 0 0 0 0 0 0 0 500\",\r\n                    duration: 0.7,\r\n                    ease: \"power3.out\",\r\n                },\r\n                \"<\"\r\n            )\r\n            .to(\r\n                this.icon,\r\n                {\r\n                    scale: 0.6,\r\n                    duration: 0.7,\r\n                    ease: \"power3.out\",\r\n                },\r\n                \"<\"\r\n            )\r\n            // 动画的第二部分：提示文字显示\r\n            .to(\r\n                this.tip,\r\n                {\r\n                    clipPath: \"circle(100%)\",\r\n                    y: 0,\r\n                    duration: 0.7,\r\n                    ease: \"power3.out\",\r\n                },\r\n                \"<0.3\"\r\n            )\r\n            .to(\r\n                this.circle,\r\n                {\r\n                    opacity: 1,\r\n                    duration: 0.7,\r\n                    ease: \"power3.out\",\r\n                },\r\n                \"<\"\r\n            );\r\n    },\r\n    // 隐藏loading动画\r\n    hidden(immediate, next) {\r\n        // 动画播放器播放完后：才可以执行函数播放后续动画，否则会因为动画冲突导致BUG\r\n        if (this.animater.isActive()) return;\r\n        if (immediate) immediate(); //存在立即执行函数，则立即执行\r\n        // 隐藏loading\r\n        this.animater = gsap\r\n            .timeline()\r\n            .to(this.tip, {\r\n                cursor: \"auto\",\r\n                scale: 0,\r\n                duration: 1,\r\n                ease: \"power3.out\",\r\n            })\r\n            .to(\r\n                this.mask,\r\n                {\r\n                    scale: 1,\r\n                    duration: 2.5,\r\n                    ease: \"power3.out\",\r\n                    onComplete: () => {\r\n                        this.if_visible.value = false; // 动画完成后，隐藏loading\r\n                        if (next) next(); //如果有后续函数，则执行\r\n                    },\r\n                },\r\n                \"<\"\r\n            );\r\n    },\r\n};\r\n// 储存全局功能函数\r\nstore.hidden_loading = loading.hidden.bind(loading);\r\nonMounted(() => {\r\n    loading.init();\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.loading {\r\n    --scale: 1;\r\n    justify-content: center;\r\n    align-items: center;\r\n    background-color: var(--color_front);\r\n    mix-blend-mode: darken;\r\n    z-index: 10000000;\r\n}\r\n\r\n.loading_icon {\r\n    position: absolute;\r\n    width: calc(var(--scale) * 35rem);\r\n}\r\n\r\n.loading_icon path {\r\n    fill: none;\r\n    stroke: var(--color_back);\r\n    stroke-linecap: round;\r\n}\r\n\r\n.loading_icon path:nth-child(1) {\r\n    stroke-width: 2;\r\n    stroke-dasharray: 0 5 0 5 0 5 0 5 0 500;\r\n}\r\n\r\n.loading_icon path:nth-child(2) {\r\n    stroke-width: 4;\r\n    stroke-dasharray: 0 500 0 500;\r\n    stroke-dashoffset: 480;\r\n}\r\n.loading_mask {\r\n    position: absolute;\r\n    width: 145vmax;\r\n    height: 145vmax;\r\n    border-radius: 100%;\r\n    background-color: var(--color_back);\r\n    transform: scale(0);\r\n}\r\n.loading_circle {\r\n    position: absolute;\r\n    width: calc(var(--scale) * 9.5rem);\r\n    height: calc(var(--scale) * 9.5rem);\r\n    border-radius: 100%;\r\n    background-color: var(--color_back);\r\n    opacity: 0;\r\n}\r\n.loading_tip {\r\n    position: absolute;\r\n    color: var(--color_front);\r\n    transition: color 0.5s var(--ease_out);\r\n    cursor: pointer;\r\n    transform: translateY(50%);\r\n    clip-path: circle(0%);\r\n}\r\n@media (hover: hover) {\r\n    .loading_tip:hover {\r\n        color: var(--color_gray);\r\n    }\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}